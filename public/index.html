<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="theme-color" content="#000" />
  <title>Meteoropolis</title>
  <link rel="icon" href="/assets/favicon.ico">
  <link rel="stylesheet" href="/assets/styles.css">
  <link rel="manifest" href="/assets/manifest.json">
</head>

<body>
  <!-- Structure -->
  <main class="content">
    <header class="header">
      <h1 class="title">Meteor<span>opolis</span></h1>
    </header>

    <figure class="photo" id="photo"></figure>

    <div class="info">
      <p class="info__item" id="conditions"></p>
      <p class="info__item">
        <a href="#" id="credit-user"></a>
        <span>on</span>
        <a href="#" id="credit-platform">Unsplash</a>
      </p>
    </div>

    <div class="thumbs" id="thumbs"></div>

    <div class="controls">
      <form class="search" id="search">
        <label class="search__label" for="search-tf">City</label>
        <input class="search__input" id="search-tf" name="city" placeholder="Enter city name" autocomplete="city" />
        <button class="btn search__btn">Go</button>
      </form>
    </div>
  </main>

  <!-- JS -->
  <script>
    (function (scope) {
      scope.init = () => {
        new Meteoropolis({
          weather: {
            apiKey: "a70fde74ccea0ae4b9d62142c9dece40",
            city: "London"
          },
          unsplash: {
            apiKey: "535abe4a18fd52841b910a3c853121ef902e958d92735c14e22828c6276eda85",
            appName: "weather"
          }
        });
      }
    })(this);
  </script>
  <script async src="/app.js" onload="init()"></script>
  <script>
    if (navigator.serviceWorker) {
      // Set up auto-updating for SW (if supported)
      if (window.BroadcastChannel) {
        const stripString = (input, strip) => {
          if (input.endsWith(strip)) {
            return input.substring(0, input.length - strip.length);
          }

          return input;
        };
        const noAction = url => url;
        const stripHtml = url => stripString(url, ".html");
        const stripIndex = url => stripString(url, "index");
        const updateChannel = new window.BroadcastChannel("precache-updates");
        const mutations = [noAction, stripHtml, stripIndex];

        updateChannel.addEventListener("message", event => {
          let updatedUrl = event.data.payload.updatedUrl;
          mutations.forEach(mutationfunc => {
            updatedUrl = mutationfunc(updatedUrl);
            if (updatedUrl === location.href) {
              console.log("This page has been updated. Please refresh the page.")
            }
          });
        });
      }

      // Initialise SW
      navigator.serviceWorker.register("/sw.js").catch(function (err) {
        console.error("Unable to register service worker.", err);
      });
    }
  </script>
</body>

</html>